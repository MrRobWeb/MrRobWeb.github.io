<template>
    <div class="flex my-10 justify-center sm:w-8/12 mx-auto animate-fade">
        <div class="flex flex-col mb-auto ">
            <div class="divide-y divide-gray-200 dark:divide-gray-700">
                <div class="space-y-2 pt-6 pb-8 md:space-y-5">
                    <h1
                        class="text-3xl font-extrabold leading-9 tracking-tight text-gray-900 dark:text-gray-100 sm:text-4xl sm:leading-10 md:text-6xl md:leading-14">
                        Projects
                    </h1>
                    <p class="text-lg leading-7 text-gray-500 dark:text-gray-400">
                        This is an exerpt of projects I've lead.
                    </p>
                </div>
                <transition-group appear tag="ul" @before-enter="beforeEnter" @enter="enter" 
                    class="divide-y divide-gray-200 dark:divide-gray-700">
                    <li v-for="(project, index) in projects" :key="project.title" :data-index="index" class="py-12">
                        <article>
                            <div class="space-y-2 xl:grid xl:grid-cols-4 xl:items-baseline xl:space-y-0">
                                <dl>
                                    <dt class="sr-only">Published on</dt>
                                    <dd class="text-base font-medium leading-6 dark:text-white"><time
                                            datetime="2021-08-07T15:32:14.000Z"> {{ project.date }} | {{ project.role }}
                                        </time></dd>
                                </dl>
                                <div class="space-y-5 xl:col-span-3">
                                    <div class="space-y-6">
                                        <div>
                                            <h2 :ref="setItemRef" class="text-2xl font-bold leading-8 tracking-tight"><a
                                                    class="text-gray-900 dark:text-white">{{ project.title }}</a></h2>
                                            <div class="flex flex-wrap">
                                                <a class="mr-3 text-sm font-medium  text-primary-500 dark:text-white hover:text-primary-600 dark:hover:text-primary-400"
                                                    v-for="technology in project.technologies">
                                                    {{ technology }}
                                                </a>
                                            </div>
                                        </div>
                                        <div v-if="show != index"
                                            class="truncate  text-gray-500 dark:text-gray-400">
                                            {{ project.description }}
                                        </div>
                                        <div v-if="show == index" class=" text-gray-500 dark:text-gray-400">
                                            {{ project.description }}
                                        </div>
                                    </div>
                                    <div class="text-base font-medium leading-6  dark:text-white">
                                        <button v-if="show != index" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"
                                            aria-label="Read &quot;New features in v1&quot;" @click="toggleShow(index)">
                                            Read more →
                                        </button>

                                        <button v-if="show == index" class="text-primary-500 hover:text-primary-600 dark:hover:text-primary-400"
                                            aria-label="Read &quot;New features in v1&quot;" @click="toggleShow(index)">
                                            Read less →
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </article>
                    </li>
                </transition-group>
            </div>
        </div>
    </div>
</template>
<script setup>
import { ref, onMounted } from 'vue';
import {storeToRefs} from 'pinia'
import Loader from '../components/Loader.vue';
import { useAppStore } from '../stores/appStore.js'
import gsap from 'gsap'



const {heightHeader, workAge} = storeToRefs(useAppStore());
// refs for scrolling
const itemRefs = ref([])
const setItemRef = (el) => {
    if (el) {
        itemRefs.value.push(el);
    }
}
const scrollIntoViewWithOffset = (el, offset) => {
  window.scrollTo({
    behavior: 'smooth',
    top:
        el.getBoundingClientRect().top -
        document.body.getBoundingClientRect().top -
        offset-30,
  })
}

const show = ref(-1);

const toggleShow = (index) => {
    if (show.value == index) {
        show.value = -1;
    } else {
        show.value = index;
    }
    setTimeout(function () {
        scrollIntoViewWithOffset(itemRefs.value[index], heightHeader.value)

    }, 200);


}

const projects = ref([
    {
        title: 'CI/CD integration for dozens of data pipelines for more then 100 customers',
        role: 'Lead DevOps Engineer',
        technologies: ['Terraform', 'AWS Codebuild|Codepipeline|Codecommit', 'Git', 'CDK', 'AWS CloudFormation'],
        date: 'April 2023 - Today',
        description: 'Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.',

    },
    {
        title: 'Data pipelines architecture based on AWS resources',
        role: 'Lead Data Architect',
        technologies: ['AWS Step Functions|State Machines|Activites', 'Spark|AWS Glue', 'Presto|AWS Athena', 'AWS Lambda', 'AWS - S3|SNS|CloudWatch|DynamoDB|EC2|Cloud9'],
        date: 'April 2023 - Today',
        description: 'Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.',
    },
    {
        title: 'Design and architecture of a progressive webapp to configure data pipelines',
        role: 'Lead Frontend Architect',
        technologies: ['Vite', 'Vue3', 'Tailwind CSS', 'aws-sdk', 'DynamoDB'],
        date: 'April 2023 - Today',
        description: 'Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.',
    },
])

const beforeEnter = (el) => {
    el.style.opacity = 0;
    el.style.transform = 'translateX(100px)'

}

const enter = (el, done) => {
    gsap.to(el, {
        opacity: 1,
        x: 0,
        duration: 0.8,
        onComplete: done,
        delay: el.dataset.index * 0.2
    })

}

</script>

<style>
/* 1. declare transition */
.fade-move,
.fade-enter-active,
.fade-leave-active {
    transition: all 0.2s cubic-bezier(0.55, 0, 0.1, 1);
}

/* 2. declare enter from and leave to state */
.fade-enter-from,
.fade-leave-to {
    opacity: 0;
    transform: scaleY(0.01) translate(30px, 0);
}

/* 3. ensure leaving items are taken out of layout flow so that moving
      animations can be calculated correctly. */
.fade-leave-active {
    position: absolute;
}
</style>